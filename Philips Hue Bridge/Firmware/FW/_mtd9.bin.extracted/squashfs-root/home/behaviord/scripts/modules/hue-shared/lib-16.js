"use strict";var script_environment=require("./lib-2.js"),Where=function(){function Where(env,config){this.env=env,this.config=config,this.allErrors=[]}return Where.prototype.processNewErrors=function(errors){return!!this.env.clipUtils.hasErrors(errors)&&(this.allErrors=this.allErrors.concat(errors),!0)},Where.prototype.claimDependencies=function(callback){var _this=this;script_environment.ForEachAndFinally(this.config,this.claim.bind(this),(function(){callback(_this.allErrors)}))},Where.prototype.claim=function(whereItem,done){var _this=this;this.env.clipUtils.getResource(whereItem.group,(function(errors,_group){var _a;_this.env.clipUtils.hasErrors(errors)?_this.processNewErrors(errors):(_this.env.dependency.claimCritical(whereItem.group.rid,whereItem.group.rtype),null===(_a=whereItem.items)||void 0===_a||_a.forEach((function(singleItem){return _this.env.dependency.claimCritical(singleItem.rid,singleItem.rtype)}))),done()}))},Where.prototype.turnOffTheLights=function(callback){var _this=this,accumulatedErrors=[];if(this.config){script_environment.ForEachAndFinally(this.config,(function(whereItem,final){if(whereItem.items){script_environment.ForEachAndFinally(whereItem.items,(function(light,done){_this.env.clipUtils.turnOffLight(light,(function(errors){_this.env.clipUtils.hasErrors(errors)&&(accumulatedErrors=accumulatedErrors.concat(errors)),done()}))}),final)}else _this.env.clipUtils.turnOffGroupOfLights(whereItem.group,(function(errors){_this.env.clipUtils.hasErrors(errors)&&(accumulatedErrors=accumulatedErrors.concat(errors)),final()}))}),(function(){return callback(accumulatedErrors)}))}},Where}();exports.Where=Where;
