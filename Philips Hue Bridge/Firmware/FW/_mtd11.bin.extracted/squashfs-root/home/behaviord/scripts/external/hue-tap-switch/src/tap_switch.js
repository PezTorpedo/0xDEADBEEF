"use strict";var Environment=require("hue-shared/lib-4.js"),script_environment=require("hue-shared/lib-2.js"),accessory=require("hue-shared/lib-6.js"),rotary_behavior=require("hue-shared/lib-10.js"),what_config=require("hue-shared/lib-11.js"),get_error_message=require("hue-shared/lib-1.js");require("hue-shared/lib-8.js"),require("hue-shared/lib-7.js"),require("hue-shared/lib-9.js"),require("hue-shared/lib-3.js"),require("hue-shared/lib-5.js");var tapSwitchButtonMap={1:"button1",2:"button2",3:"button3",4:"button4"},MODEL_IDS=["RDM002"],TapDialSwitch=function(){function TapDialSwitch(context,env,resultCallback){this.context=context,this.env=env,this.init(resultCallback)}return TapDialSwitch.prototype.init=function(resultCallback){var _this=this,config=this.context.config,accessory$1=new accessory.Accessory(config.device,this.env,this.context,what_config.defaultConfiguration,MODEL_IDS);accessory$1.getServices((function(_device,services){var _a,rotary=services.filter(accessory.filterItemsByType("relative_rotary"))[0];if(!rotary)return resultCallback("Expecting a rotary service, but none was found");var buttonConfig=services.filter(accessory.filterItemsByType("button")).reduce((function(map,button){var _a;return Environment.__assign(Environment.__assign({},map),((_a={})[button.id]=tapSwitchButtonMap[button.metadata.control_id],_a))}),{}),buttonCount=Environment.values(buttonConfig).filter(Boolean).length;if(4!==buttonCount)return resultCallback("Expecting 4 buttons but found ".concat(buttonCount));accessory$1.install(rotary_behavior.SwitchBehavior,{buttons:buttonConfig}).enableLatencyMetadataTransferWithTag("HTDS_button_scene_recall"),accessory$1.install(rotary_behavior.RotaryBehavior,{rotaries:(_a={},_a[rotary.id]="rotary",_a)}),accessory$1.init(resultCallback,resultCallback)}),(function(e){return resultCallback(get_error_message.GetErrorMessage(e,_this.env.log))}))},TapDialSwitch.Environment=script_environment.ScriptEnvironmentWithClipUtils,TapDialSwitch}();module.exports=TapDialSwitch;
