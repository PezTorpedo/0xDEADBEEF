"use strict";var script_environment=require("hue-shared/lib-2.js"),accessory=require("hue-shared/lib-6.js"),Environment=require("hue-shared/lib-4.js"),recipe=require("hue-shared/lib-5.js");require("hue-shared/lib-8.js"),require("hue-shared/lib-7.js"),require("hue-shared/lib-9.js"),require("hue-shared/lib-3.js"),require("hue-shared/lib-1.js");var RecallRecipeAction=function(){function RecallRecipeAction(env,where,what,defaultState){this.env=env,this.where=where,this.what=what,this.defaultState=defaultState}return RecallRecipeAction.prototype.execute=function(state){void 0===state&&(state=this.defaultState);var recipeAction=recipe.Recipe.get(this.what.recall.rid),groupedLight=this.where.groupedLight;groupedLight&&this.env.clipUtils.setLightState(groupedLight,Environment.__assign(Environment.__assign({},recipeAction.action),state),(function(){}))},RecallRecipeAction.prototype.init=function(doneCallback){var groupedLight=this.where.groupedLight,recipeAction=recipe.Recipe.get(this.what.recall.rid);groupedLight?recipeAction?doneCallback():doneCallback("Failed fetching recipe with rid ".concat(this.what.recall.rid)):doneCallback("Failed fetching grouped light ".concat(this.where.group.rid))},RecallRecipeAction}(),ContactSensorBehavior=function(){function ContactSensorBehavior(_device,context){this.context=context}return Object.defineProperty(ContactSensorBehavior.prototype,"config",{get:function(){return this.context.context.config},enumerable:!1,configurable:!0}),Object.defineProperty(ContactSensorBehavior.prototype,"where",{get:function(){var _a;return(_a={}).DEVICE=this.config.where,_a},enumerable:!1,configurable:!0}),Object.defineProperty(ContactSensorBehavior.prototype,"what",{get:function(){var _a;return(_a={}).DEVICE=[this.config.when.always.on_close,this.config.when.always.on_open],_a},enumerable:!1,configurable:!0}),ContactSensorBehavior.prototype.init=function(source,callback){var contactSensorServices=source.getServicesByType("contact");if(!contactSensorServices.length)return callback("No contact service found");this.context.subscribeToUpdateEvents(contactSensorServices,this.onContactSensorEvent.bind(this)),callback()},ContactSensorBehavior.prototype.onContactSensorEvent=function(_serviceId,events){var _this=this;events.forEach((function(event){var _a,_b;if("contact"===event.type&&event.contact_report&&void 0===event.enabled){var timerType=null===(_a=_this.config.when.always.on_close.timer)||void 0===_a?void 0:_a.type,timeout=null===(_b=_this.config.when.always.on_close.timer)||void 0===_b?void 0:_b.duration;"contact"!==event.contact_report.state||void 0!==_this.timerId&&"time_out_after"!==timerType||_this.handleEventAndCancelTimer(event),"no_contact"===event.contact_report.state&&(_this.handleEventAndCancelTimer(event),timeout&&timerType&&(_this.timerId=_this.context.env.timer.setTimeout(Environment.fbind(_this.handle,_this,"contact"),timeout)))}}))},ContactSensorBehavior.prototype.handle=function(eventAction){var _this=this,scene=this.context.env.state.get("previous_state");scene&&"no_contact"===eventAction?scene.updatePrivateScene((function(){return _this.executeActions(eventAction)})):this.executeActions(eventAction)},ContactSensorBehavior.prototype.executeActions=function(eventAction){this.context.executeActions("DEVICE","contact"===eventAction?this.config.when.always.on_close:this.config.when.always.on_open,[eventAction])},ContactSensorBehavior.prototype.handleEventAndCancelTimer=function(event){this.handle(event.contact_report.state),this.timerId&&(this.context.env.timer.cancelTimer(this.timerId),this.timerId=void 0)},Object.defineProperty(ContactSensorBehavior.prototype,"speakers",{get:function(){return{}},enumerable:!1,configurable:!0}),ContactSensorBehavior}(),customWhatConfiguration={all_off:accessory.createGroupedLightOffAction,last_on:accessory.createLastOnAction,do_nothing:accessory.createEmptyAction,recall_single:accessory.createRecallSingleAction,previous_state:accessory.createGroupedPreviousStateAction("previous_state"),recall:{recipe:function(context,what,where){return new RecallRecipeAction(context.env,where,what)},scene:accessory.createRecallSceneAction,smart_scene:accessory.createRecallSmartSceneAction}},MODEL_IDS=["SOC001"],ContactSensor=function(){function ContactSensor(context,env,resultCallback){this.context=context,this.env=env,this.init(resultCallback)}return ContactSensor.prototype.init=function(resultCallback){var accessory$1=new accessory.Accessory(this.context.config.device,this.env,this.context,customWhatConfiguration,MODEL_IDS);accessory$1.install(ContactSensorBehavior,this.context.config.device),accessory$1.init(resultCallback,resultCallback)},ContactSensor.Environment=script_environment.ScriptEnvironmentWithClipUtils,ContactSensor}();module.exports=ContactSensor;
