"use strict";var Environment=require("hue-shared/lib-4.js"),get_error_message=require("hue-shared/lib-1.js"),script_environment=require("hue-shared/lib-2.js"),where=require("hue-shared/lib-16.js");function LeavingHome(context,env,callback){this.env=env,this.context=context,this.activated=!0,this.init(callback)}Object.defineProperty(LeavingHome.prototype,"where",{get:function(){return new where.Where(this.env,this.context.config.where)}}),LeavingHome.prototype.init=function(callback){this.where.claimDependencies(callback)},LeavingHome.prototype.activateLeavingHome=function(){const self=this;self.where.turnOffTheLights((function(errors){void 0!==errors&&errors.length>0&&self.env.log.inform("Lights are already off or unreachable: "+get_error_message.GetErrorMessage(errors))}))},LeavingHome.prototype.onGeofenceEvent=function(geofenceEvent){this.env.log.inform("geofence event handled at "+(new Date).toString()+" activated: "+JSON.stringify(this.activated)),this.activated&&!geofenceEvent.any_at_home&&this.activateLeavingHome()},LeavingHome.prototype.run=function(){this.env.geofence.subscribe(Environment.fbind(this.onGeofenceEvent,this))},LeavingHome.prototype.trigger=function(action){const self=this;self.env.log.inform("received trigger: "+JSON.stringify(action)),"leaving home"===action.debug&&self.activateLeavingHome(),void 0!==action.enabled&&(self.activated=action.enabled)},LeavingHome.Environment=script_environment.ScriptEnvironmentWithClipUtils,module.exports=LeavingHome;
