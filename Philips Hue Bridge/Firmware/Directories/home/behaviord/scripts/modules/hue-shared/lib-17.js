"use strict";var Environment=require("./lib-4.js"),fromDate=function(date){return{hour:date.getHours(),minute:date.getMinutes(),second:date.getSeconds()}},toSeconds=function(time){var _a;return 3600*time.hour+60*time.minute+(null!==(_a=time.second)&&void 0!==_a?_a:0)},normaliseTimeslots=function(slot,_index,slots){return slot<slots[0]?slot+86400:slot},getTimeWithinBounds=function(slots,index,slotTime){void 0===slotTime&&(slotTime=slots[index]);var minTime=slots[0]+1800*index,maxTime=slots[slots.length-1]-1800*(slots.length-index-1);return slotTime=Math.max(minTime,slotTime),slotTime=Math.min(maxTime,slotTime)},Time={fromDate:fromDate,todayAtTime:function(time){var date=new Date;return date.setHours(time.hour,time.minute,time.second||0),date},getTimeslotsSyncedToSunset:function(sunInfo,slots){var sunriseSlotIndex=Environment.findIndex(slots,(function(slot){return"sunrise"===slot.start_time.type})),sunsetSlotIndex=Environment.findIndex(slots,(function(slot){return"sunset"===slot.start_time.type}));if(sunsetSlotIndex<0||sunriseSlotIndex>=0)return slots;var slotTimes=slots.map(function(sunInfo){return function(item){if("sunset"!==item.start_time.type)return item.start_time.time;switch(sunInfo.day_type){case"polar_night":return{hour:0,minute:0,second:0};case"polar_day":return{hour:23,minute:59,second:59};default:return fromDate(sunInfo.sunset)}}}(sunInfo)).map(toSeconds).map(normaliseTimeslots),sunsetTime=getTimeWithinBounds(slotTimes,sunsetSlotIndex,slotTimes[sunsetSlotIndex]%86400);slotTimes[sunsetSlotIndex]=sunsetTime;var slotsBeforeSunset=slotTimes.slice(0,sunsetSlotIndex+1),slotsAfterSunset=slotTimes.slice(sunsetSlotIndex),syncedSlotTimes=slotTimes.map((function(time,index){return 0===index||index===slots.length-1?time:index===sunsetSlotIndex?sunsetTime:index<sunsetSlotIndex?getTimeWithinBounds(slotsBeforeSunset,index):getTimeWithinBounds(slotsAfterSunset,index-sunsetSlotIndex)}));return slots.map((function(slot,index){return Environment.__assign(Environment.__assign({},slot),{start_time:{type:"time",time:(seconds=syncedSlotTimes[index],{minute:Math.floor(seconds%3600/60),hour:Math.floor(seconds%86400/3600)})}});var seconds}))}};exports.Time=Time;
